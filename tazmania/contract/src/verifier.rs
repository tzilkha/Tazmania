use electron_rs::verifier::near::*;

struct Verifier {
    pvk: PreparedVerifyingKey,
}

impl Verifier {
    fn new(vk: String) -> Self {
        let vk = parse_verification_key(vk).unwrap();
        let pvk = get_prepared_verifying_key(vk);

        Self { pvk }
    }
    pub fn verify(&self, proof: String, public: String) -> bool {
        verify_proof(self.pvk.clone(), proof, public).unwrap()
    }
}

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn init() {
        let public = r#"
            [
             "14114388566649458089567037548032873808524665301324522922664751829136768599953",
             "11778569245147538738994022322712725094916340624517029213976247073592110043835",
             "392447876613848656153530375380014738288157039009961297597965706573149173904",
             "402723358401870841845924799958129372930931573276288829990548027205756269982",
             "8386118591345224033",
             "21870330214396494648306347048839789929268180026404274656479428607042378997599",
             "9959799011492141004048909943289992950702542243170832133160614861503109056019",
             "18821149189096667250796217436172301968381333159728907852040828491847637085860",
             "1401310692506522118617197026487452037393843805631973495032068699390570112185",
             "4057262369199308539619537600285613381005753170839949224262220438326586256183",
             "16925907532462604309693855471654629996779145039230254152336917868509706986730",
             "10021499548603791450506909865772403007671432755078048009690476073836242108744",
             "21475168894586242642573379050169307025739088917148521411107929722014308641950",
             "7360862125041007647535909459418449150011144866363969273450247671871925823603",
             "19062274585331525760992870914394525531476195459859315357022598821345321120784",
             "19718462354469171828916175206128741732712887229363508525972707917966068030517",
             "17891164335104822980406542090546385321609621388232396374888269271317287400872",
             "13480415811146975161232747525661448544235197699616023153614441620855938279383",
             "42314818008518682761356057487977385647296034201640471672770788444553597495",
             "10878462807742340577769937187979149900187355092492962216914112610381967566830",
             "13036216860713620859152019489911042389296743470194781363609924351775004625854",
             "1319172525195610605384688338906282115454130170797843554597967066665105498002",
             "15526326359474258460364354910344438839702890502138118885599562792313799823674",
             "11183771857808615109234679738401322345981330576849051609979920254410011750793",
             "8586044829685451122964649942000395692265498829069832112928147020769047120189",
             "8717146151766481969504883242881207717088297387346871750601774715789664288187",
             "1759676980396483934242279604673752938886010740796809575347596232872588778685",
             "17413547587400585821975403380242954754962097456486292678882721606133207134510",
             "14727548221642501517188020125792430556358261144351176641393030078195906858252",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0",
             "0"
            ]
        "#;

        let proof = r#"
            {
             "pi_a": [
              "20101007275229603929285903075683104204827533337827191636932513902988549223514",
              "49087883164691990095440523167087220132748804910084896537454568571466259723",
              "1"
             ],
             "pi_b": [
              [
               "12299160747270766531608511535558185978795949671828237714272090221600384393255",
               "12728589276748893356988669518791340182268081017562545618095087790168402940672"
              ],
              [
               "13677934758833867676728778157627020199659034631284161620473855297958365009395",
               "6605595395769312703672934518057765052441730849579908992399725904884978181952"
              ],
              [
               "1",
               "0"
              ]
             ],
             "pi_c": [
              "4615798794730107088383228811826196267778214749012648727461073165043155091244",
              "12057049396301132504552157814158313047376930578440033266391484578207231290964",
              "1"
             ],
             "protocol": "groth16",
             "curve": "bn128"
            }
        "#;

        println!("Testing verifier..");
        let v = Verifier::new(get_vkey());
        let r = v.verify(proof.to_string(), public.to_string());
        println!("verifier: {}", r);
    }
}

fn get_vkey() -> String {
    let vkey_str = r#"
        {
         "protocol": "groth16",
         "curve": "bn128",
         "nPublic": 54,
         "vk_alpha_1": [
          "20491192805390485299153009773594534940189261866228447918068658471970481763042",
          "9383485363053290200918347156157836566562967994039712273449902621266178545958",
          "1"
         ],
         "vk_beta_2": [
          [
           "6375614351688725206403948262868962793625744043794305715222011528459656738731",
           "4252822878758300859123897981450591353533073413197771768651442665752259397132"
          ],
          [
           "10505242626370262277552901082094356697409835680220590971873171140371331206856",
           "21847035105528745403288232691147584728191162732299865338377159692350059136679"
          ],
          [
           "1",
           "0"
          ]
         ],
         "vk_gamma_2": [
          [
           "10857046999023057135944570762232829481370756359578518086990519993285655852781",
           "11559732032986387107991004021392285783925812861821192530917403151452391805634"
          ],
          [
           "8495653923123431417604973247489272438418190587263600148770280649306958101930",
           "4082367875863433681332203403145435568316851327593401208105741076214120093531"
          ],
          [
           "1",
           "0"
          ]
         ],
         "vk_delta_2": [
          [
           "14202137062297104666419440098388793200612409057624553364399106363663266251594",
           "20699975492378921560252143214848832760935868091360899930159439218144400371985"
          ],
          [
           "7601868512459960033740057574485605717342160112351911075628983029979719289113",
           "6126195510899372073226899505531184841660595784022258250689601099534176704444"
          ],
          [
           "1",
           "0"
          ]
         ],
         "vk_alphabeta_12": [
          [
           [
            "2029413683389138792403550203267699914886160938906632433982220835551125967885",
            "21072700047562757817161031222997517981543347628379360635925549008442030252106"
           ],
           [
            "5940354580057074848093997050200682056184807770593307860589430076672439820312",
            "12156638873931618554171829126792193045421052652279363021382169897324752428276"
           ],
           [
            "7898200236362823042373859371574133993780991612861777490112507062703164551277",
            "7074218545237549455313236346927434013100842096812539264420499035217050630853"
           ]
          ],
          [
           [
            "7077479683546002997211712695946002074877511277312570035766170199895071832130",
            "10093483419865920389913245021038182291233451549023025229112148274109565435465"
           ],
           [
            "4595479056700221319381530156280926371456704509942304414423590385166031118820",
            "19831328484489333784475432780421641293929726139240675179672856274388269393268"
           ],
           [
            "11934129596455521040620786944827826205713621633706285934057045369193958244500",
            "8037395052364110730298837004334506829870972346962140206007064471173334027475"
           ]
          ]
         ],
         "IC": [
          [
           "14197337208806770545889220037358805071954256513497618666763526856238699710862",
           "9453653003318842103590170162898346038399530062335296624636426850906339758932",
           "1"
          ],
          [
           "7374419710074923783649892211890616707963750737341310197238451007583332192797",
           "4777866817750211338926228749453665894287783251391950411282042253958828314422",
           "1"
          ],
          [
           "5944135141027406582923479745934505228510427791131178445052716386361609615767",
           "12206970540198405095222264634510513580619878699676273073206648968392358034589",
           "1"
          ],
          [
           "9263148446380344153215759997559864759609115131537418664430657346201906278695",
           "8758998321246568680760952744425371093458049498353334000649023068159433485977",
           "1"
          ],
          [
           "8771134848399241205410932868256424426974623239186820261077910148549647635373",
           "7945370117950689983400329903258113172756555078641373330585795258711757706159",
           "1"
          ],
          [
           "21082800817063042785329934587048173077642800314558025881170540101745838149752",
           "6159370236638953911091085682093230919245415646856993012906171689775573745736",
           "1"
          ],
          [
           "13897125479498094046979599955126590786017258313576016189557469170367339778271",
           "16276545760842104710741665247009420693778041239215190109152939230165921548009",
           "1"
          ],
          [
           "4629596528876501705215144362253400421037398701330168401984538665544046431555",
           "8743434108159561819810251826573866645567159023576152131370107055322425280197",
           "1"
          ],
          [
           "1132597771188731226152163513590833257207905176338618480380432948106892731182",
           "8302098725557022224928042852610409095310673237471048917149631934460177716172",
           "1"
          ],
          [
           "20333806819295165901383168592750106671823299647965747317590102926632076587426",
           "13009533945481142269487876930913194957218015074165178486185591103835356275399",
           "1"
          ],
          [
           "19601910763938405859903031855007529073560672782846897700380401738335541685073",
           "4725258170893374524547405915931676814848557543988898580868318737242312243769",
           "1"
          ],
          [
           "8369645440507886687770428013827147953142580550444682204839702476780017025538",
           "9506664432148001801892790877051799740727021381434887241985216882490546102512",
           "1"
          ],
          [
           "13350913065017700856367671188416553914663544921728160156157289944950500442061",
           "1604280753967770754584412746402724983022099302919516169885121232710575974598",
           "1"
          ],
          [
           "2166529464567314932796062330000375645378837314961936484227148095955672109655",
           "7455300067286922468714536341321309459093591095684934320788903163945383853234",
           "1"
          ],
          [
           "18255886745262123712891293705433971309304600360181849896819341229136758598211",
           "6331080942097854954062135172117043783962568803387101736091745696713136253934",
           "1"
          ],
          [
           "2894948404885972568592271185636429783138965263358992449259480841547843580311",
           "1152891268363097102406417024899904227084245560304642120195129493910963671449",
           "1"
          ],
          [
           "20192117332915233428267501275250377223487475236092967475979024580900737248844",
           "856355229217893728398279938025561581440530135809751263740982555563755229522",
           "1"
          ],
          [
           "18296453336828255563530524846621707267174721184988294836149218401016350572885",
           "3816417316037058585593497492705374811515487422810822583947831304001297930526",
           "1"
          ],
          [
           "4271392097872463768990276405047656584757993433609720230447795652365788486114",
           "20150788686303278428643304505145883374456982431420553666538930888917493995945",
           "1"
          ],
          [
           "8740622918318282841388799578475376483769073393404947224046735007839941632620",
           "5230136846845572446137432618008049994897116809529724902277895021832218939631",
           "1"
          ],
          [
           "5309864177476819791861613048635534919508667653896557492846147260056319156942",
           "11683238307269379935556385267718437520993836146925328570160235683948572867117",
           "1"
          ],
          [
           "5841886099120230912659827057192544699728815712271324083877176907798686466994",
           "18411791638599564372597356493594538657133270369983089827373064644058958720567",
           "1"
          ],
          [
           "20857770961128039930481153301613568369502249025324893057683674081037144150958",
           "15916472852533786731516038042839103344878176324214589165458964487855142061900",
           "1"
          ],
          [
           "10756373383849394989515534983474581800494494002657453833353819384961306661588",
           "635020544182116903901155709228469648731222131872638440460821106328432896531",
           "1"
          ],
          [
           "13131734240061153020266508049891951806776670149489458166655528379508968046914",
           "10965607571229405974523134882688907641601203163499858921450611579599900541596",
           "1"
          ],
          [
           "3072951175153857430564215351017790410877537829798424091791639742478253447697",
           "21361349521232018332229632652007084479693980221893650096807091047689989032882",
           "1"
          ],
          [
           "8067718085763213108619532624462581741412622555928703544249219319859098128454",
           "4440755255174590572361085621081006380409431438896822527951821762636598969753",
           "1"
          ],
          [
           "9289483784542071098229203984178645360221423604322465364629178710692523507924",
           "16018082653237358632148020690134377308016340900420560688284825284766794382745",
           "1"
          ],
          [
           "20470981088150606198408192498480287570295407044630760096360386704990615079451",
           "8307661499441393551703167536845225141676923752494068129197982490752973498464",
           "1"
          ],
          [
           "8948873199917465085769783603531608381803644925487944073683862045154093896794",
           "15013340691511422908363480037141668327030494699651535189467900272215752001206",
           "1"
          ],
          [
           "7666611387775337511786870785117757501063523592198519967662589464976898881535",
           "19512067480297447454116672550054825375610286497732213940774225474757220021187",
           "1"
          ],
          [
           "18607551097622355148048144144734680034101901590491791846361723801833636661430",
           "1267470109976017503345003857048568083989506001268645142306425230830516376913",
           "1"
          ],
          [
           "20938588811789476843614474378172337461759455739384312774725078328179264412740",
           "25729770305862799649424995286649503389712791492799094757864988807082798765",
           "1"
          ],
          [
           "3335138575327189015337344496597418083077843266581065225135750298411308331294",
           "9704723520047673183185184209611652324476120530137145188469332389450142687365",
           "1"
          ],
          [
           "12879435873166018859674386981771868919765400669369717755888210934077821428905",
           "4075128708446214882467629200209259101566408914326809012988971672084110258159",
           "1"
          ],
          [
           "4299604623393907900728302527141628984496632129055789707848239759316434852947",
           "13498824495529158655036159312709310021231045183201627072615054425028528358066",
           "1"
          ],
          [
           "1774569199963452400078538131578329044908855364636329001229632860351508026455",
           "11877311652739209333080591058163801934997464595800336739750392883164329066087",
           "1"
          ],
          [
           "7399121820610322071313394157106086581834170259323221475427401299753868462854",
           "3593875609341301538154281686359333979163144121688086130123550158575976839723",
           "1"
          ],
          [
           "1108122984601258797949582553180753557309506913313182919719976728119038524360",
           "16007483299230621928122184666142620008494185605798313866246495816665807870434",
           "1"
          ],
          [
           "9210950732151494875684014409851899077325939276548813978645833363060851197415",
           "6825144736062860688415258265338712499154132637706468315145441775116701904558",
           "1"
          ],
          [
           "3749674880062879419767498068604212731190195025227536709041748572237377567661",
           "13766103130567485295640866441071832118841531145615157071529556406720863467800",
           "1"
          ],
          [
           "9852787849627106728077606317743875001553885419963026276924318869974440124164",
           "2134372403349249277667756818339940256922797672879623146293872176616594748724",
           "1"
          ],
          [
           "5102064318238796359823951924315780972633473472453901974271529185763117544577",
           "16502739763625762644203527655111795002454237402868695192590757836511101886518",
           "1"
          ],
          [
           "6762903583995455506294571383084378807293391399074613941684197228613787639935",
           "2787050289681412867997668755313930133696684102531190397086207623944695225505",
           "1"
          ],
          [
           "1526542253411557491958539954844762241531415732477747204054215760092845857070",
           "8897942224867483483879327481659146540332141065559570394261496324182157587313",
           "1"
          ],
          [
           "12387407562116093904798997451984326633915321531103293405826321751551364510694",
           "1004704986725874781828966000014422123132336784093226420260416486890844944478",
           "1"
          ],
          [
           "13796934307305712600234322273723832817601771986428116681854773819622631858964",
           "17933348075086926366470513092342277003129437496552058482716090183940317586096",
           "1"
          ],
          [
           "2868559178988327959454708208542928362366755637175427185023493787336831041787",
           "15653507098346745772784701926266536671510409825256293366130244318708464554177",
           "1"
          ],
          [
           "18631902252461238032916627113756415530038682388670669206062440113971921070340",
           "354006907458388750064572852396293389513017804889084879958299468778822529724",
           "1"
          ],
          [
           "16857989371619614272879661196229717235244902050303033260495743237719006157437",
           "1212976779352569436314116261106297222406339294513820355689856492029844023220",
           "1"
          ],
          [
           "7292927322938547908537616136160687927996008266031104276764759483253540249681",
           "12044610581491179124292364669593377651341629919870632618568479214296309570350",
           "1"
          ],
          [
           "15492313473787481432507624045590319475419171747568229903559931561970147922691",
           "6884393607156048517715374272677805521930791020287074571573035728970501304833",
           "1"
          ],
          [
           "17028705465051262791623345581035453834472424504722456870753817914476302401868",
           "4521844422616011581818557564892362258625339131051717778265279953003407317270",
           "1"
          ],
          [
           "18873766500030692959120851215155152919075487366298923927644156872439316950582",
           "21323414172580544072410444903028692769538008596995528983498156770476965131996",
           "1"
          ],
          [
           "12749101301122959894603675585975440280939827614642448241582857652194773300051",
           "20170857737149918381211792136202396318677848651023231747055150968448016401161",
           "1"
          ]
         ]
        }
    "#;
    vkey_str.to_string()
}
